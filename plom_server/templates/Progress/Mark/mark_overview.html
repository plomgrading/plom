<!--
    SPDX-License-Identifier: AGPL-3.0-or-later
    Copyright (C) 2023 Brennen Chiu
    Copyright (C) 2023-2026 Andrew Rechnitzer
    Copyright (C) 2023, 2025 Colin B. Macdonald
    Copyright (C) 2025 Bryan Tanady
    Copyright (C) 2026 Aidan Murphy
-->
{% extends "base/base.html" %}
{% block title %}
    Marking Progress
{% endblock title %}
{% block page_heading %}
    Marking progress
{% endblock page_heading %}
{% block main_content %}
    {% if user_is_lead_marker or user_is_manager %}
        <div>
            <p>
                <a class="btn btn-primary" href="{% url 'progress_landing' %}">Marking and Identifying</a>
            </p>
        </div>
    {% endif %}
    {% if missing_task_count > 0 %}
        <div class="container w-100 alert alert-warning">
            There are {{ missing_task_count }} missing tasks.
            {% if user_is_manager %}
                You may want to examine the
                <a class="btn btn-outline-secondary btn-sm align-baseline"
                   href="{% url 'scan_list_incomplete' %}">list of incomplete paper</a>.
            {% else %}
                Use a manager account to examine the list of incomplete papers.
            {% endif %}
        </div>
    {% endif %}
    <div class="container w-100">
        <!-- If only a single version, then put all Q's on one row. Else one row per question. This could be dry'd more -->
        {% if versions|length == 1 %}
            <div class="row justify-content-between mb-2">
                {% for qidx, qlabel, qlabel_html in question_labels_html %}
                    {% for ver in versions %}
                        <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-3 p-1">
                            {% if task_counts|get_item:qidx|get_item:ver|get_item:"total" > 0 %}
                                {% include "Progress/Mark/mark_stats_card.html" with question_idx=qidx question_label_html=qlabel_html version=ver task_status_counts=task_counts|get_item:qidx|get_item:ver histogram_data=data_for_histograms|get_item:qidx|get_item:ver counts_and_markers=who_marked_how_many|get_item:qidx|get_item:ver %}
                            {% else %}
                                <div class="mt-4 text-body text-opacity-25 text-center">
                                    <h5>No tasks Q{{ qlabel }}</h5>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>
        {% else %}
            {% for qidx, qlabel, qlabel_html in question_labels_html %}
                <div class="row justify-content-between mb-2">
                    {% for ver in versions %}
                        <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-3 p-1">
                            {% if task_counts|get_item:qidx|get_item:ver|get_item:"total" > 0 %}
                                {% include "Progress/Mark/mark_stats_card.html" with question_idx=qidx question_label_html=qlabel_html version=ver task_status_counts=task_counts|get_item:qidx|get_item:ver histogram_data=data_for_histograms|get_item:qidx|get_item:ver counts_and_markers=who_marked_how_many|get_item:qidx|get_item:ver %}
                            {% else %}
                                <div class="mt-4 text-body text-opacity-25 text-center">
                                    <h5>No tasks v{{ ver }}</h5>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                <hr/>
                <!-- DELETE ME -->
            {% endfor %}
        {% endif %}
    </div>
    <!-- include this for tool-tips on the progress bar -->
    <!-- https://getbootstrap.com/docs/5.3/components/tooltips -->
    <script>
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    </script>
{% endblock main_content %}
