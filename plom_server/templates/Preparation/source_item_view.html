<!--
    SPDX-License-Identifier: AGPL-3.0-or-later
    Copyright (C) 2024 Aden Chan
    Copyright (C) 2025-2026 Colin B. Macdonald
    Copyright (C) 2026 Aidan Murphy
-->
{% if request_is_htmx %}
    <h4 class="card-title" hx-swap-oob="innerHTML:#source_status">
        You have uploaded {{ num_uploaded_source_versions }} of {{ num_versions }} source pdfs
        {% if all_sources_uploaded %}
            <i class="bi bi-check-circle text-success"></i>
        {% else %}
            <i class="bi bi-exclamation-diamond-fill text-warning"></i>
        {% endif %}
    </h4>
{% endif %}
<div class="card" id="card-{{ src.version }}">
    <div class="card-body">
        {% if error %}<div class="alert alert-danger" role="alert">{{ message }}</div>{% endif %}
        {% if src.uploaded %}
            <h5 class="card-title">
                PDF for version {{ src.version }}: <a target="_blank" href={{ src.version }}>{{ src.original_filename }}</a>
                <i class="bi bi-check-circle text-success"></i>
            </h5>
            <p class="card-text">
                sha256: <small class="text-muted"><tt>{{ src.hash }}</tt></small>
                {% if src.duplicate_versions %}
                    <i class="bi bi-exclamation-diamond-fill text-warning"></i>
                    duplicate of version{{ src.duplicate_versions|pluralize }}: {{ src.duplicate_versions|join:", " }}
                {% endif %}
                <br />
                {{ src.page_count }} pages of &ldquo;{{ src.paper_size_name }}&rdquo; paper
                <span class="text-muted">({{ src.paper_size_width|stringformat:".6g" }} &times; {{ src.paper_size_height|stringformat:".6g" }} pts)</span>.
            </p>
            <div class="row row-cols-auto px-2">
                <div class="px-1 col">
                    <button class="btn btn-primary"
                            href="{% url 'prep_mock' src.version %}"
                            target="_blank">Mock</button>
                </div>
                <div class="px-1 col">
                    <button class="btn btn-danger"
                            hx-delete="{{ src.version }}"
                            hx-confirm="Are you sure?"
                            hx-target="#card-{{ src.version }}"
                            hx-swap="outerHTML">Delete</button>
                </div>
            </div>
        {% else %}
            <h5 class="card-title">
                PDF for version {{ src.version }}
                <i class="bi bi-exclamation-diamond-fill text-warning"></i>
            </h5>
            <div class="card-text">
                <form enctype="multipart/form-data"
                      id="form-{{ src.version }}"
                      hx-post="{% url 'prep_source_upload' src.version %}"
                      hx-target="#card-{{ src.version }}">
                    {% csrf_token %}
                    <div class="mb-2">
                        <input class="form-control"
                               type="file"
                               name="source_pdf"
                               accept="application/pdf"
                               required
                               id="pdf_file">
                    </div>
                    <button class="btn btn-primary" type="submit">upload</button>
                </form>
            </div>
        {% endif %}
    </div>
</div>
